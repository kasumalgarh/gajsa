<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day Book & Vouchers - Arth Book</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">

    <style>
        /* === VOUCHERS / DAY BOOK SPECIFIC STYLES === */
        
        .main-area { background: #f8fafc; overflow-y: hidden; }
        .content-scroll { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 80px; }

        /* Top Filters Bar */
        .top-bar {
            background: white;
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            display: flex; flex-direction: column; gap: 15px; height: auto;
        }
        .tb-header { display: flex; justify-content: space-between; align-items: center; width: 100%; }
        .top-bar h2 { margin: 0; font-size: 1.5rem; color: var(--primary); font-weight: 800; }
        
        .filters { display: flex; gap: 12px; flex-wrap: wrap; margin-top: 5px; align-items: center; }
        .filter-input, .search-box {
            padding: 10px 14px; border: 1px solid var(--border); border-radius: 8px;
            font-size: 14px; min-width: 140px; outline: none; transition: border 0.2s;
        }
        .filter-input:focus, .search-box:focus { border-color: var(--primary); }

        .btn-refresh {
            background: var(--accent); color: var(--primary-dark); border: none;
            padding: 10px 18px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: 0.2s;
        }
        .btn-refresh:hover { background: #ffd54f; transform: rotate(180deg); transition: transform 0.5s; }
        
        .btn-new {
            background: var(--primary); color: white; border: none; padding: 10px 20px;
            border-radius: 8px; cursor: pointer; font-weight: 700; display: flex; align-items: center; gap: 8px; text-decoration: none;
            box-shadow: 0 4px 6px rgba(13, 71, 161, 0.2);
        }
        .btn-new:hover { background: var(--primary-dark); transform: translateY(-1px); }

        /* Table Styles */
        .table-container {
            background: white; border-radius: 10px; overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08); margin-top: 20px;
        }
        table { width: 100%; border-collapse: collapse; }
        th { background: var(--primary); color: white; padding: 14px 16px; font-weight: 600; text-align: left; font-size: 13px; text-transform: uppercase; letter-spacing: 0.5px; }
        td { padding: 14px 16px; border-bottom: 1px solid #e2e8f0; font-size: 14px; color: #334155; }
        tr:last-child td { border-bottom: none; }
        tr:hover { background: #f8fafc; }

        .amount { font-family: 'JetBrains Mono', monospace; font-weight: 700; color: var(--text-main); text-align: right; }
        
        /* VISUAL LOGIC: Money In vs Money Out */
        .amt-in { color: #10b981; } /* Green */
        .amt-out { color: #1e293b; } /* Standard Dark */

        .actions { white-space: nowrap; text-align: right; }
        .actions button {
            background: none; border: none; cursor: pointer; font-size: 16px;
            margin: 0 8px; color: #94a3b8; transition: 0.2s;
        }
        .actions button:hover { color: var(--primary); transform: scale(1.2); }
        .actions .del-btn:hover { color: var(--red); }

        /* Badge Enhancements */
        .vtype-badge {
            padding: 4px 10px; border-radius: 20px; font-size: 11px;
            font-weight: 700; color: white; text-transform: uppercase; letter-spacing: 0.5px;
            display: inline-block; min-width: 80px; text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .badge-Payment { background: #f59e0b; color: #fff; }
        .badge-Receipt { background: #10b981; color: #fff; }
        .badge-Contra { background: #64748b; color: #fff; }
        .badge-Journal { background: #3b82f6; color: #fff; }
        .badge-Sales { background: #0d47a1; color: #fff; }
        .badge-Purchase { background: #d946ef; color: #fff; }
        .badge-CreditNote { background: #ef4444; color: #fff; }
        .badge-DebitNote { background: #8b5cf6; color: #fff; }

        #noData {
            background: white; border-radius: 12px; padding: 60px 20px;
            text-align: center; margin-top: 20px; display: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.06);
        }
        #noData i { font-size: 64px; color: #cbd5e1; margin-bottom: 20px; }

        #loading { text-align: center; padding: 40px; display: none; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid var(--accent); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Mobile Card View */
        @media (max-width: 768px) {
            .top-bar { height: auto; padding: 15px; }
            .tb-header { flex-direction: column; align-items: flex-start; gap: 10px; }
            .filters { width: 100%; flex-direction: column; align-items: stretch; }
            .btn-new { width: 100%; justify-content: center; }

            .table-container { background: transparent; box-shadow: none; }
            table { border: 0; }
            thead { display: none; }
            
            tr {
                display: block; margin-bottom: 15px; border: 1px solid var(--border);
                border-radius: 10px; background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.05);
                position: relative; padding-bottom: 10px;
            }
            td {
                display: block; text-align: right; border: none; padding: 10px 15px;
                position: relative; border-bottom: 1px solid #f1f5f9;
            }
            td:last-child { border-bottom: 0; }
            td:before {
                content: attr(data-label);
                position: absolute; left: 15px; width: 45%;
                font-weight: 700; text-align: left; color: #64748b; font-size: 12px; text-transform: uppercase;
            }
            td.amount { font-size: 18px; }
            td.amount:before { content: "Amount"; top: 12px; }
            td.actions { text-align: center; border-top: 1px dashed #e2e8f0; padding-top: 15px; }
            td.actions:before { display: none; }
        }
    </style>
</head>
<body>
 <div class="sidebar" id="sidebar">
        <div class="brand-logo" style="padding: 20px; font-size: 20px; font-weight: 800; color: white; display: flex; align-items: center; gap: 10px;">
            <i class="fas fa-cube"></i> Arth Book
        </div>
        <ul class="nav-links" style="list-style: none; padding: 0 10px;">
            <li><a href="index.html"><i class="fas fa-home"></i> Dashboard</a></li>
            <li><a href="sales_invoice.html"><i class="fas fa-file-invoice"></i> Sales (POS)</a></li>
            <li><a href="purchase_invoice.html"><i class="fas fa-truck"></i> Purchase</a></li>
            <li><a href="vouchers.html"><i class="fas fa-receipt"></i> Day Book</a></li>
            
            <li style="margin-top:15px; margin-bottom:5px; font-size:11px; color:#64748b; font-weight:bold; padding-left:15px; text-transform:uppercase;">Masters</li>
            <li><a href="item_master.html"><i class="fas fa-boxes"></i> Inventory</a></li>
            <li><a href="ArthBook.html"><i class="fas fa-users"></i> Parties</a></li>
            <li><a href="coa.html"><i class="fas fa-sitemap"></i> Accounts</a></li>
            
            <li style="margin-top:15px; margin-bottom:5px; font-size:11px; color:#64748b; font-weight:bold; padding-left:15px; text-transform:uppercase;">Reports & Tax</li>
            <li><a href="reports.html"><i class="fas fa-chart-line"></i> Reports</a></li>
            <li><a href="gst_filing.html"><i class="fas fa-university"></i> GST Returns</a></li>
            <li><a href="taxation.html"><i class="fas fa-calculator"></i> Tax / ITR</a></li>
            
            <hr style="border:0; border-top:1px solid rgba(255,255,255,0.1); margin:15px 5px;">
            <li><a href="settings.html"><i class="fas fa-cog"></i> Settings</a></li>
            <li><a href="help.html"><i class="fas fa-question-circle"></i> Help</a></li>
        </ul>
        
        <div style="padding: 20px; font-size: 11px; color: #64748b; text-align: center; margin-top:auto;">
            Arth Book v4.0<br>Authorized User
        </div>
    </div>

    <div class="main-area">
        <div class="top-bar">
            <div class="tb-header">
                <h2>Day Book</h2>
                <a href="voucher_entry.html" class="btn-new">
                    <i class="fas fa-plus"></i> New Entry
                </a>
            </div>
            
            <div class="filters">
                <input type="date" id="dateFrom" class="filter-input">
                <input type="date" id="dateTo" class="filter-input">
                
                <select id="typeFilter" class="filter-input">
                    <option value="All">All Vouchers</option>
                    <option value="Payment">Payment</option>
                    <option value="Receipt">Receipt</option>
                    <option value="Contra">Contra</option>
                    <option value="Journal">Journal</option>
                    <option value="Sales">Sales</option>
                    <option value="Purchase">Purchase</option>
                </select>

                <div style="position:relative; flex:1;">
                    <i class="fas fa-search" style="position:absolute; left:12px; top:12px; color:#94a3b8;"></i>
                    <input type="text" id="searchBox" class="search-box" style="width:100%; padding-left:35px;" placeholder="Search Voucher No, Amount...">
                </div>

                <button class="btn-refresh" onclick="renderVouchers()"><i class="fas fa-sync-alt"></i></button>
            </div>
        </div>

        <div class="content-scroll">
            <div id="loading"><div class="spinner"></div><p style="margin-top:10px; color:#64748b;">Loading Vouchers...</p></div>
            
            <div id="noData">
                <i class="fas fa-folder-open"></i>
                <h3>No Vouchers Found</h3>
                <p style="color:#64748b;">Try changing the date range or filters.</p>
            </div>

            <div class="table-container" id="tableWrap">
                <table>
                    <thead>
                        <tr>
                            <th width="15%">Date</th>
                            <th width="15%">Voucher No</th>
                            <th>Narration / Particulars</th>
                            <th width="10%">Type</th>
                            <th width="15%" style="text-align:right;">Amount</th>
                            <th width="10%" style="text-align:center;">Action</th>
                        </tr>
                    </thead>
                    <tbody id="voucherTable">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="db.js"></script>
    <script>
        window.onload = async () => {
            await DB.init();
            
            const date = new Date();
            const firstDay = new Date(date.getFullYear(), date.getMonth(), 1);
            const lastDay = new Date(date.getFullYear(), date.getMonth() + 1, 0);
            
            document.getElementById('dateFrom').valueAsDate = firstDay;
            document.getElementById('dateTo').valueAsDate = lastDay;

            renderVouchers();

            document.getElementById('typeFilter').addEventListener('change', renderVouchers);
            document.getElementById('dateFrom').addEventListener('change', renderVouchers);
            document.getElementById('dateTo').addEventListener('change', renderVouchers);
            
            let timeout;
            document.getElementById('searchBox').addEventListener('keyup', (e) => {
                clearTimeout(timeout);
                timeout = setTimeout(renderVouchers, 300);
            });
        };

        async function renderVouchers() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('tableWrap').style.display = 'none';
            document.getElementById('noData').style.display = 'none';

            const vData = await DB.getAll('vouchers');
            
            const from = document.getElementById('dateFrom').value;
            const to = document.getElementById('dateTo').value;
            const type = document.getElementById('typeFilter').value;
            const search = document.getElementById('searchBox').value.toLowerCase();

            const filtered = vData.filter(v => {
                const vDate = v.date; 
                const matchDate = (!from || vDate >= from) && (!to || vDate <= to);
                const matchType = type === 'All' || v.type === type;
                const matchSearch = v.voucher_no.toLowerCase().includes(search) || 
                                    (v.narration && v.narration.toLowerCase().includes(search)) ||
                                    v.amount.toString().includes(search);
                
                return matchDate && matchType && matchSearch;
            });

            filtered.sort((a,b) => b.date.localeCompare(a.date) || b.id - a.id);

            const tbody = document.getElementById('voucherTable');
            const noData = document.getElementById('noData');
            const tableWrap = document.getElementById('tableWrap');
            
            tbody.innerHTML = '';
            document.getElementById('loading').style.display = 'none';

            if (filtered.length === 0) {
                noData.style.display = 'block';
                return;
            }

            tableWrap.style.display = 'block';

            filtered.forEach(v => {
                const displayDate = v.date.split('-').reverse().join('-'); 
                const badgeClass = `badge-${v.type.replace(/\s/g, '')}` || 'badge-Contra';

                // VISUAL LOGIC: Green for Money In (Receipt/Sales), Normal for Money Out
                const isMoneyIn = ['Receipt', 'Sales', 'Credit Note'].includes(v.type);
                const amtClass = isMoneyIn ? 'amt-in' : 'amt-out';
                const sign = isMoneyIn ? '+' : '';

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td data-label="Date">${displayDate}</td>
                    <td data-label="Voucher No" style="font-weight:600;">${v.voucher_no}</td>
                    <td data-label="Narration">
                        <div style="font-weight:600; color:var(--text-main);">${v.type}</div>
                        <div style="font-size:12px; color:#64748b; font-style:italic;">${v.narration || 'No Narration'}</div>
                    </td>
                    <td data-label="Type"><span class="vtype-badge ${badgeClass}">${v.type}</span></td>
                    <td data-label="Amount" class="amount ${amtClass}">${sign}â‚¹${parseFloat(v.amount).toFixed(2)}</td>
                    <td data-label="Action" class="actions">
                        <button onclick="editVoucher(${v.id})" title="Edit"><i class="fas fa-edit"></i></button>
                        <button class="del-btn" onclick="deleteVoucher(${v.id}, this)" title="Delete"><i class="fas fa-trash-alt"></i></button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        async function deleteVoucher(id, btn) {
            if(confirm("Are you sure you want to delete this voucher? This cannot be undone.")) {
                try {
                    const icon = btn.querySelector('i');
                    icon.className = "fas fa-spinner fa-spin";
                    
                    await DB.deleteVoucher(id);
                    renderVouchers();
                } catch(e) {
                    alert("Delete Failed: " + e);
                    const icon = btn.querySelector('i'); // Fix ref
                    icon.className = "fas fa-trash-alt"; 
                }
            }
        }

        function editVoucher(id) {
            window.location.href = `voucher_entry.html?id=${id}&mode=edit`;
        }
    </script>
</body>
</html>